version: '3.7'

services:
  ruby:
    build: .
    expose:
      - 9090 # Envoy connects to ruby gRPC Server on 9090
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - envoy
    networks:
      default:
        aliases:
          - ruby
    entrypoint: ./entrypoint.rb

  # Used as a reference gRPC-Web server to test against
  envoy:
    image: envoyproxy/envoy:latest
    expose:
      - 8080
    volumes:
      - ./spec/support/envoy.yml:/etc/envoy/envoy.yaml
    networks:
      default:
        aliases:
          - envoy

networks:
  default:
